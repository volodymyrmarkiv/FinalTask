---
# tasks file for jenkins
- block: # Install Jenkins to AmazonLinux1

  - name: Add official Jenkins repo for CentOS
    get_url:
      url: https://pkg.jenkins.io/redhat-stable/jenkins.repo
      dest: /etc/yum.repos.d/jenkins.repo

  - name: import jenkins key
    rpm_key:
      state: present
      key: https://pkg.jenkins.io/redhat-stable/jenkins.io.key

  - name: Install Jenkins
    yum: update_cache=yes name=jenkins state=present

  - name: Start and enable Jenkins during boot
    service: name=jenkins state=started enabled=yes

# Create directory if not exists
  - name: Create initialization scripts directory
    file: 
      path: '{{ jenkins_home }}/init.groovy.d'
      state: directory
      owner: jenkins
      group: jenkins
      mode: 0775

  - name: Add initialization script to setup basic security
    template: 
      src: security.groovy
      dest: '{{ jenkins_home }}/init.groovy.d/security.groovy'
      owner: jenkins
      group: jenkins
      mode: 0775
    notify: Restart Jenkins

  - name: Time for restarting Jenkins
    pause:
      seconds: 30

  - name: Install plugin
    jenkins_plugin:
      name: blueocean

  when: inventory_hostname == "AmazonLinux"